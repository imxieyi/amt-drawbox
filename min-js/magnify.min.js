!function(t){t.fn.magnify=function(n){var e=t.extend({speed:100,timeout:-1,onload:function(){}},n),i=function(n){var i,a,o,s,r,l,d,f,c,u=t(n),h=u.closest("a"),g=0,m=0,v=u.attr("data-magnify-src")||e.src||h.attr("href")||"",p=function(){a.is(":visible")&&a.fadeOut(e.speed,function(){t("html").removeClass("magnifying")})};if(v){u.data("originalStyle",u.attr("style"));var y=new Image;t(y).on({load:function(){u.css("display","block"),u.parent(".magnify").length||u.wrap('<div class="magnify"></div>'),i=u.parent(".magnify"),u.prev(".magnify-lens").length?i.children(".magnify-lens").css("background-image","url('"+v+"')"):u.before('<div class="magnify-lens loading" style="background:url(\''+v+"') no-repeat 0 0\"></div>"),a=i.children(".magnify-lens");for(var n=0;n<4;n++)t(".magnify-lens").append("<section></section>");a.removeClass("loading"),g=y.width,m=y.height,o=i.offset(),s=i.width(),r=i.height(),l=u.width(),d=u.height(),f=a.width(),c=a.height(),u.data("zoomSize",{width:g,height:m}),y=null,e.onload(),i.on("mousemove touchmove",function(n){n.preventDefault();var i=(n.pageX||n.originalEvent.touches[0].pageX)-o.left,u=(n.pageY||n.originalEvent.touches[0].pageY)-o.top;if(a.is(":animated")||(i<s&&u<r&&i>0&&u>0?a.is(":hidden")&&(t("html").addClass("magnifying"),a.fadeIn(e.speed)):p()),a.is(":visible")){var h=i-f/2,v=u-c/2;if(g&&m)var y=Math.round(i/l*g-f/2)*-1,b=Math.round(u/d*m-c/2)*-1,w=y+"px "+b+"px";a.css({top:Math.round(v)+"px",left:Math.round(h)+"px",backgroundPosition:w||""})}}),i.mouseleave(p),e.timeout>=0&&i.on("touchend",function(){setTimeout(p,e.timeout)}),t("body").not(i).on("touchstart",p),h.length&&(h.css("display","inline-block"),!h.attr("href")||u.attr("data-magnify-src")||e.src||h.click(function(t){t.preventDefault()}))},error:function(){y=null}}),y.src=v}};return this.destroy=function(){this.each(function(){var n=t(this),e=n.data("originalStyle");e?n.attr("style",e):n.removeAttr("style"),n.unwrap(".magnify").prevAll(".magnify-lens").remove()})},this.each(function(){i(this)})}}(jQuery);